/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.4.4
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var MTE=function(e,t){function n(e){return void 0!==e}function r(e){return"string"==typeof e}function l(e){return"number"==typeof e}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e}function a(e,t,n){return t="on"+t,null===n?e[t]=null:(i(e[t])&&(n=function(e,t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),void(e[t]=n))}function c(e,t){e=e||{};for(var n in t)e[n]=o(t[n])?c(e[n],t[n]):t[n];return e}function u(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),r=0;return r=Y.defaultView&&Y.defaultView.getComputedStyle?Y.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function s(e,t){return dt(e,function(){vt(t.end+1,bt)}),!1}function f(e){return e.replace(/^\s+|\s+$/g,"")}function p(e){return e.replace(/^\s+/,"")}function d(e){return e.replace(/\s+$/,"")}function g(e){return e.replace(X.escape,"\\$1")}function h(e){return e.parentNode}var v="\u2018",m="\u2019",b="\u201C",x="\u201D",k="\u2013",C="\u2014",$="\u2026",y="\u00A6",E="\u00A9",T="\u2117",L="\u2120",O="\u2122",_="\u00AE",H="\u00B1",R="\u00D7",w="\u00F7",N="\u00B0",M="\u2039",A="\u203A",B="\u00AB",S="\u00BB",I="\u2264",U="\u2265",z="\u2260",K="\u2190",D="\u2192",P="\u2191",q="\u2193",F="\u21B5",Q="\u00B7",V=this,W=window,Y=document,X=new Editor(e),j=function(){},G={tabSize:"    ",toolbar:!0,shortcut:!1,areaClass:"editor-area",toolbarClass:"editor-toolbar",toolbarIconClass:"fa fa-%s",toolbarButtonClass:"editor-toolbar-button editor-toolbar-button-%s",toolbarSeparatorClass:"editor-toolbar-separator",toolbarPosition:"before",dropClass:"custom-drop custom-drop-%s",modalClass:"custom-modal custom-modal-%s",modalHeaderClass:"custom-modal-header custom-modal-%s-header",modalContentClass:"custom-modal-content custom-modal-%s-content",modalFooterClass:"custom-modal-action custom-modal-%s-action",modalOverlayClass:"custom-modal-overlay custom-modal-%s-overlay",closeATXHeader:!1,STRONG:"**",EM:"_",UL:"- ",OL:"%d. ",HR:"---",CODE:"`",PRE:"    ",BLOCKQUOTE:"> ",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",code:"Code",quote:"Quote",heading:"H1 "+k+" H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here"+$,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here"+$,heading_text:"Heading",link_text:"link text",list_ul_text:"List item",list_ol_text:"List item",image_alt:"Image"},update:j,keydown:j,click:j,ready:j,copy:j,cut:j,paste:j},J=Y.body,Z=Y.createElement("div"),et=Y.createElement("div"),tt=Y.createElement("div"),nt=0,rt=null,lt=null,it=0,ot=0,at=0,ct=0,ut=J.parentNode.offsetWidth,st=W.innerHeight>J.parentNode.offsetHeight?W.innerHeight:J.parentNode.offsetHeight,ft=e,pt=X.indent,dt=X.insert,gt=X.outdent,ht=X.replace,vt=X.select,mt=X.selection,bt=X.updateHistory,xt=X.wrap,kt=c(G,t),Ct=Y.createElement("span");V.DOM={overlay:Z,modal:et,drop:tt};var $t=g(kt.UL).replace(/\\[-+*]/g,"[-+*]"),yt=g(kt.OL).replace(/%d/g,"\\d+"),Et=g(kt.tabSize),Tt=g(kt.PRE),Lt=g(kt.BLOCKQUOTE);V.shortcuts=[],V.shortcut=function(e,t){V.shortcuts[e.toLowerCase()]=t,V.shortcuts=function(){for(var e=Object.keys(V.shortcuts).sort().reverse(),t={},n=0,r=e.length;r>n;++n)t[e[n]]=V.shortcuts[e[n]];return t}()},V.event=function(e,t,n){return a(t,e,n)},V.modal=function(e,t,n){i(e)&&(n=t,t=e,e="default"),e=e||"default",n=n||{},nt=J.scrollTop||J.parentNode.scrollTop,Z.className=kt.modalOverlayClass.replace(/%s/g,e),et.className=kt.modalClass.replace(/%s/g,e),et.innerHTML='<div class="'+kt.modalHeaderClass.replace(/%s/g,e)+'"></div><div class="'+kt.modalContentClass.replace(/%s/g,e)+'"></div><div class="'+kt.modalFooterClass.replace(/%s/g,e)+'"></div>';var r=et.style,l="left"in n,o="top"in n;r.visibility="hidden",J.appendChild(Z),J.appendChild(et),W.setTimeout(function(){var e=et.offsetWidth,t=et.offsetHeight;r.position="absolute",r.left=l?n.left+"px":"50%",r.top=o?n.top+"px":"50%",r.zIndex="9999",r.marginLeft=(l?0:0-e/2)+"px",r.marginTop=(o?0:nt-t/2)+"px",r.visibility="",et.offsetLeft<0&&!l&&(r.left=0,r.marginLeft=0,l=!0,n.left=0),et.offsetTop<0&&!o&&(r.top=0,r.marginTop=0,o=!0,n.top=0);var i=et.children[0];a(i,"mousedown",function(){return lt=et,at=it-lt.offsetLeft,ct=ot-lt.offsetTop,!1}),a(J,"mousemove",null),a(J,"mousemove",function(n){it=n.pageX,ot=n.pageY+nt;var i,a,c=l?0:e/2,u=o?0:t/2;if(null!==lt){var s=l?e:0,f=o?t:0;i=it-at+c,a=ot-ct+u,c>i&&(i=c),u>a&&(a=u),i+c+s>ut&&(i=ut-c-s),a+u+f>st&&(a=st-u-f),r.left=i+"px",r.top=a-nt+"px"}})},10);var c=et.children;i(t)&&t(Z,et,c[0],c[1],c[2])},V.drop=function(e,t,n){i(e)&&(n=t,t=e,e="default"),!n&&rt&&(n={left:rt.offsetLeft,top:rt.offsetTop+rt.offsetHeight}),e=e||"default",n=n||{},nt=J.scrollTop||J.parentNode.scrollTop,tt.className=kt.dropClass.replace(/%s/g,e);var r=tt.style,l="left"in n,o="top"in n;r.visibility="hidden",J.appendChild(tt),W.setTimeout(function(){var e=tt.offsetWidth,t=tt.offsetHeight;r.position="absolute",r.left=l?n.left+"px":"50%",r.top=o?n.top+"px":"50%",r.zIndex="9999",r.marginLeft=(l?0:0-e/2)+"px",r.marginTop=(o?0:nt-t/2)+"px",r.visibility="",n.left+e>ut&&(r.left=ut-e+"px",r.marginLeft=0),n.top+t>st&&(r.top=st-t+"px",r.marginTop=0)},10),i(t)&&t(tt)},V.prompt=function(e,t,n,r,l){V.modal("prompt",function(l,o,c,u,s){var f=function(e){i(r)?(V.close(),r(e)):V.close(!0)},p=Y.createElement("input");p.type="text",p.value=t,a(p,"keydown",function(e){var r=e.keyCode;if(27==r)return V.close(!0),!1;if(40==r)return d.focus(),!1;if(n){if(13==r&&""!==this.value&&this.value!==t)return f(this.value),!1}else if(13==r)return f(this.value==t?"":this.value),!1});var d=Y.createElement("button");d.innerHTML=kt.buttons.ok,a(d,"click",function(){return n?""!==p.value&&p.value!==t&&f(p.value):f(p.value==t?"":p.value),!1});var g=Y.createElement("button");g.innerHTML=kt.buttons.cancel,a(g,"click",function(){return V.close(!0),!1}),a(d,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):38==t?(p.focus(),!1):39==t||40==t?(g.focus(),!1):void 0}),a(g,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):37==t||38==t?(d.focus(),!1):40==t?!1:void 0}),c.innerHTML=e?e:"",u.appendChild(p),s.appendChild(d),s.appendChild(Y.createTextNode(" ")),s.appendChild(g),W.setTimeout(function(){p.select()},10)},l)},V.alert=function(e,t,n,r){V.modal("alert",function(r,l,o,c,u){var s=Y.createElement("button");s.innerHTML=kt.buttons.ok,a(s,"click",function(){return i(n)?(V.close(),n()):V.close(!0),!1}),a(s,"keydown",function(e){return 27==e.keyCode?(V.close(!0),!1):void 0}),o.innerHTML=e?e:"",c.innerHTML=t?t:"",u.appendChild(s),W.setTimeout(function(){s.focus()},10)},r)},V.confirm=function(e,t,r,l){V.modal("confirm",function(l,o,c,u,s){var f=Y.createElement("button");f.innerHTML=kt.buttons.ok,a(f,"click",function(){return n(r)&&i(r.OK)?(V.close(),r.OK()):V.close(!0),!1});var p=Y.createElement("button");p.innerHTML=kt.buttons.cancel,a(p,"click",function(){return n(r)&&i(r.CANCEL)?(V.close(),r.CANCEL()):V.close(!0),!1}),a(f,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):39==t||40==t?(p.focus(),!1):void 0}),a(p,"keydown",function(e){var t=e.keyCode;return 27==t?(V.close(!0),!1):37==t||38==t?(f.focus(),!1):40==t?!1:void 0}),c.innerHTML=e?e:"",u.innerHTML=t?t:"",s.appendChild(f),s.appendChild(Y.createTextNode(" ")),s.appendChild(p),W.setTimeout(function(){p.focus()},10)},l)},V.close=function(e){if(rt=null,lt=null,h(Z)&&J.removeChild(Z),h(et)&&J.removeChild(et),h(tt)&&J.removeChild(tt),e&&e!==!1){var t=mt();o(e)||(e={}),vt("start"in e?e.start:t.start,"end"in e?e.end:t.end)}},a(W,"resize",function(){ut=J.parentNode.offsetWidth,st=W.innerHeight>J.parentNode.offsetHeight?W.innerHeight:J.parentNode.offsetHeight}),a(J,"mouseup",function(){lt=null}),a(Z,"click",function(){V.close(!0)}),V.scroll=function(e,t){l(e)?ft.scrollTop=e:ft.scrollTop+=parseInt(u(ft,"line-height"),10),i(t)&&t()},V.time=function(e){var t=new Date,r=t.getFullYear(),l=t.getMonth()+1,i=t.getDate(),o=t.getHours(),a=t.getMinutes(),c=t.getSeconds(),u=t.getMilliseconds();10>l&&(l="0"+l),10>i&&(i="0"+i),10>o&&(o="0"+o),10>a&&(a="0"+a),10>c&&(c="0"+c),10>u&&(u="0"+u);var s={Y:""+r,m:""+l,d:""+i,H:""+o,i:""+a,s:""+c,u:""+u};return n(e)?s[e]:s},kt.toolbar&&(Ct.className=kt.toolbarClass,ft.parentNode.insertBefore(Ct,"before"==kt.toolbarPosition?ft:null));var Ot=Y.createElement("a");Ot.href="#esc:"+(new Date).getTime(),Ot.style.width=0,Ot.style.height=0,ft.parentNode.appendChild(Ot),V.button=function(e,t){if("|"===e)return V.separator(t);if(t=t||{},t.title!==!1){var n,c=Y.createElement("a");if(c.className=kt.toolbarButtonClass.replace(/%s/g,e),c.setAttribute("tabindex",-1),c.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),c.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+kt.toolbarIconClass.replace(/%s/g,e)+'"></i>',t.title&&(c.title=t.title),o(t.attr))for(var u in t.attr)if(r(t.attr[u])&&"+="==t.attr[u].slice(0,2)){var s=c.getAttribute(u)||"";c.setAttribute(u,s+t.attr[u].slice(2))}else c.setAttribute(u,t.attr[u]);a(c,"click",function(e){if(i(t.click)){var n=this.hash.replace("#","");return V.close(),rt=c,t.click(e,V),kt.click(e,V,n),kt.update(e,V,n),!1}}),a(c,"keydown",function(e){return 27==e.keyCode?(V.close(!0),!1):void 0}),l(t.position)?(n=t.position<0?t.position+Ct.children.length+1:t.position-1,Ct.insertBefore(c,Ct.children[n]||null)):Ct.appendChild(c),G.buttons[e]=t}},V.separator=function(e){e=e||{};var t,n=Y.createElement("span");if(n.className=kt.toolbarSeparatorClass,o(e.attr))for(var i in e.attr)if(r(e.attr[i])&&"+="==e.attr[i].slice(0,2)){var a=n.getAttribute(i)||"";n.setAttribute(i,a+e.attr[i].slice(2))}else n.setAttribute(i,e.attr[i]);l(e.position)?(t=e.position<0?e.position+Ct.children.length+1:e.position-1,Ct.insertBefore(n,Ct.children[t]||null)):Ct.appendChild(n)},X.tidy=function(e,t,r,l){r=n(r)?r:e;var o,a=mt(),c=-1===e.indexOf("\n")&&a.before.match(/\n$/),u=-1===r.indexOf("\n")&&a.after.match(/^\n/),s=c?a.before:d(a.before),g=f(a.value),h=u?a.after:p(a.after),v=s.length&&!c?e:"",m=h.length&&!u?r:"";return a.value.length&&!l&&i(t)?t(a):(ft.value=s+v+g+m+h,o=s.length+v.length,vt(o,o+g.length),void(i(t)&&t(mt())))},X.toggle=function(e,t,n,r){var l=mt();if(l.before.slice(-e.length)!=e&&l.after.slice(0,t.length)!=t)xt(e,t,!l.value.length&&r?function(){ht(/^/,r===!0?kt.placeholders.text:r)}:1);else{var o=l.before.slice(-e.length)==e?l.before.slice(0,-e.length):l.before,a=l.after.slice(0,t.length)==t?l.after.slice(t.length):l.after;ft.value=o+l.value+a,vt(o.length,o.length+l.value.length,bt)}i(n)&&n()};var _t=0,Ht=kt.buttons,Rt=X.tidy,wt=X.toggle,Nt={bold:{title:Ht.bold,click:function(){var e=kt.STRONG;Rt(" ",function(){wt(e,e,1,!0)})}},italic:{title:Ht.italic,click:function(){var e=kt.EM;Rt(" ",function(){wt(e,e,1,!0)})}},"quote-right":{title:Ht.quote,click:function(){var e=mt(),t=kt.BLOCKQUOTE,n=d(e.before),r=f(e.value),l=(p(e.after),n.length?"\n\n":"",kt.placeholders.text);r==l?vt():(e.before.match(RegExp(Lt+"$"))||Rt("\n\n",1,"\n\n",!0),X[r.match(RegExp("^"+Lt))?"outdent":"indent"](t,e.value.length?1:function(){ht(/^/,kt.placeholders.text)}))}},code:{title:Ht.code,click:function(){var e=mt(),t="("+Tt+"|\\t| {4})",n=e.before.match(RegExp("(^|\\n)"+t+"?$")),r=kt.CODE,l=kt.PRE;if(n)if(-1===l.indexOf("%s"))Rt("\n\n",function(){X[e.value.match(RegExp("^"+t))?"outdent":"indent"](l,e.value.length?1:function(){ht(/^/,kt.placeholders.text)})},"\n\n",!0);else{var i=l.split("%s");Rt("\n\n",function(){e=mt(),wt(i[0],i[1]||i[0],1,!0)},"\n\n",!e.before.match(RegExp(g(i[0])+"$")))}else Rt(" ",function(){wt(r,r,1,!0)})}},header:{title:Ht.heading,click:function(){var e,t=mt(),n=["","=","-","###","####","#####","######"],r=d(t.before.replace(/#+ $/,"")),l=f(t.value.replace(/#+ | #+|\n+[-=]+/g,"").replace(/\n+/g," ")),i=p(t.after.replace(/^( #+|\n+[-=]+)/g,"")),o=r.length?"\n\n":"",a=i.length?"\n\n":"";if(_t=_t<n.length-1?_t+1:0,t.value.length){if(_t>0&&3>_t)ft.value=r+o+l+"\n"+l.replace(/./g,n[_t])+a+i,e=r.length+o.length;else{var c=_t>0?" ":"";ft.value=r+o+n[_t]+c+l+(kt.closeATXHeader?c+n[_t]:"")+a+i,e=r.length+o.length+n[_t].length+c.length}vt(e,e+l.length,bt)}else{var u=kt.placeholders.heading_text;_t=1,ft.value=r+o+u+"\n"+u.replace(/./g,n[_t])+a+i,e=r.length+o.length,vt(e,e+u.length,bt)}}},link:{title:Ht.link,click:function(e){var t,n,r=mt(),l=kt.placeholders.link_text;V.prompt(kt.prompts.link_url_title,kt.prompts.link_url,!0,function(i){n=i,V.prompt(kt.prompts.link_title_title,kt.prompts.link_title,!1,function(i){t=i.replace(/'/g,"&apos;").replace(/"/g,"&quot;"),Rt(" ",function(){xt("[","]("+n+(""!==t?' "'+t+'"':"")+")",r.value.length?1:function(){ht(/^/,l)})}),kt.update(e,V)})})}},image:{title:Ht.image,click:function(e){V.prompt(kt.prompts.image_url_title,kt.prompts.image_url,!0,function(t){Rt("\n\n",function(){var e=mt(),n=f(e.value.length?e.value:decodeURIComponent(t.split("/").pop().replace(/\..*$/,"").replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}));n.length||(n=kt.placeholders.image_alt),dt("!["+n+"]("+t+")",function(){e=mt(),e.after.length||(ft.value+="\n\n"),vt(e.end+2,bt)})},"\n\n",!0),kt.update(e,V)})}},"list-ol":{title:Ht.ol,click:function(){var e=mt(),t=kt.placeholders.list_ol_text,n=0;if(e.value.length)e.value==t?vt():e.value.match(RegExp("^ *"+yt))?gt(" *"+yt,1,!0):pt("",function(){ht(RegExp("(^|\\n) *"+$t+" *","g"),"$1",j),ht(/^[^\n]/gm,function(e){return n++,e.replace(/^/," "+kt.OL.replace(/%d/g,n))})});else if(e.before.match(/(^|\n)$/)){var r=" "+kt.OL.replace(/%d/g,1);Rt("\n\n",function(){dt(r+t,function(){e=mt(),vt(e.end-t.length,e.end,bt)})},"\n\n",!0)}else{var l=RegExp("(^|\\n) *"+yt+"(.*?)$"),i=e.before.replace(l,"$1$2");if(e.before.match(l))ft.value=i+e.after,vt(i.length,bt);else{var o=RegExp("(?:^|\\n) *("+yt+").*?\n.*?$").exec(e.before),r=" "+kt.OL.replace(/%d/g,o&&o[1]?parseInt(o[1],10)+1:1);e.before=e.before.replace(RegExp("(^|\\n) *"+$t+"(.*?)$"),"$1$2").replace(/(^|\n)(.*?)$/,"$1"+r+"$2"),ft.value=e.before+e.after,vt(e.before.length,bt)}}}},"list-ul":{title:Ht.ul,click:function(){var e=mt(),t=kt.placeholders.list_ul_text,n=" "+kt.UL;if(e.value.length)e.value==t?vt():(ht(RegExp("(^|\\n) *"+yt+" *","g"),"$1",j),X[e.value.match(RegExp("^ *"+$t))?"outdent":"indent"](n));else if(e.before.match(/(^|\n)$/))Rt("\n\n",function(){dt(n+t,function(){e=mt(),vt(e.end-t.length,e.end,bt)})},"\n\n",!0);else{var r=RegExp("(^|\\n) *"+$t+"(.*?)$"),l=e.before.replace(r,"$1$2");e.before.match(r)?(ft.value=l+e.after,vt(l.length,bt)):(e.before=e.before.replace(RegExp("(^|\\n) *"+yt+"(.*?)$"),"$1$2").replace(/(^|\n) *(.*?)$/,"$1"+n+"$2"),ft.value=e.before+e.after,vt(e.before.length,bt))}}},"ellipsis-h":{title:Ht.rule,click:function(){Rt("\n\n",function(){dt(kt.HR,function(){var e=mt();e.after.length||(ft.value+="\n\n"),vt(e.end+2,bt)})},"\n\n",!0)}},undo:{title:Ht.undo,click:X.undo},repeat:{title:Ht.redo,click:X.redo}};for(var Mt in Nt)V.button(Mt,Nt[Mt]);a(ft,"focus",V.close),a(ft,"copy",function(e){var t=mt();W.setTimeout(function(){kt.copy(t),kt.update(e,V)},1)}),a(ft,"cut",function(e){var t=mt();W.setTimeout(function(){t.end=t.start,kt.cut(t),kt.update(e,V),bt()},1)}),a(ft,"paste",function(e){var t=mt();W.setTimeout(function(){t.end=mt().end,t.value=ft.value.substring(t.start,t.end),kt.paste(t),kt.update(e,V),bt()},1)}),a(ft,"keydown",function(e){var t=mt(),n=t.before,r=t.value,l=t.after,i=t.start,o=t.end,a=e.keyCode,c=e.ctrlKey,u=e.shiftKey,f=e.altKey,p=9==a;W.setTimeout(function(){kt.keydown(e,V),kt.update(e,V)},1);for(var h in V.shortcuts){var Y=h.split("+"),G=0;for(var J in Y)("ctrl"==Y[J]&&c||"shift"==Y[J]&&u||"alt"==Y[J]&&f||"tab"==Y[J]&&p||parseInt(Y[J],10)==a)&&G++;if(G===Y.length)return V.shortcuts[h](e,V)}var Z=n,et=l[0],tt="\\"==Z.slice(-1);if(-1!==Z.indexOf("(")&&u&&48==a&&")"==et&&!tt||-1!==Z.indexOf("{")&&u&&221==a&&"}"==et&&!tt||-1!==Z.indexOf("[")&&221==a&&"]"==et&&!tt||-1!==Z.indexOf('"')&&u&&222==a&&'"'==et&&!tt||-1!==Z.indexOf("'")&&!u&&222==a&&"'"==et&&!tt||-1!==Z.indexOf("`")&&!u&&192==a&&"`"==et&&!tt||-1!==Z.indexOf("<")&&u&&190==a&&">"==et&&!tt)return vt(o+1),!1;if(u&&57==a&&!tt)return s("("+r+")",t);if(u&&219==a&&!tt)return s("{"+r+"}",t);if(!u&&219==a&&!tt)return s("["+r+"]",t);if(u&&222==a&&!tt)return s('"'+r+'"',t);if(!u&&222==a&&!tt&&!n.match(/\w$/))return s("'"+r+"'",t);if(!u&&192==a&&!tt&&!n.match(/\w$/))return s("`"+r+"`",t);if(u&&188==a&&!tt)return s("<"+r+">",t);if(u&&p)return gt("( *"+yt+"| *"+$t+"| *"+Lt+"|"+Et+")",1,!0),!1;if(p){if(n.match(/<[^\/>]*?$/)&&">"==l[0]){var nt=/<([^\/>]*?)$/.exec(n);return ft.value=n+" "+r+"></"+nt[1].split(" ")[0]+l,vt(i+1,bt),!1}return pt(kt.tabSize),!1}if(c&&90==a)return X.undo(),!1;if(c&&89==a)return X.redo(),!1;if(kt.shortcut){if(c&&66==a)return Nt.bold.click(),!1;if(c&&71==a)return Nt.image.click(),!1;if(c&&72==a)return Nt.header.click(),!1;if(c&&73==a)return Nt.italic.click(),!1;if(c&&!u&&75==a)return Nt.code.click(),!1;if(c&&76==a)return Nt.link.click(),!1;if(c&&81==a)return Nt["quote-right"].click(),!1;if(c&&82==a)return Nt["ellipsis-h"].click(),!1;if(c&&61==a)return Nt["list-ol"].click(),!1;if(c&&173==a)return Nt["list-ul"].click(),!1}if(32==a){var nt="(^|\\n)("+d(yt)+"|"+d($t)+")";if(n.match(RegExp(nt+"$")))return ft.value=n.replace(RegExp(nt+"$"),"$1 $2 ")+r+l,vt(o+2,bt),!1}if(13==a){if(f&&!r.length)return dt(F),!1;var rt=RegExp("(?:^|\\n)( *)("+yt+"|"+$t+"|(?:"+Lt+")+)( *)(.*?)$");if(n.match(rt)){var lt=rt.exec(n),it=RegExp(yt).test(lt[2])?kt.OL.replace(/%d/g,parseInt(lt[2],10)+1):lt[2];return dt("\n"+lt[1]+it+lt[3],1),V.scroll(),!1}var ot=RegExp("(?:^|\\n)(("+Et+")+)(.*?)$").exec(n),at=ot?ot[1]:"";return n.match(/[\(\{\[]$/)&&l.match(/^[\]\}\)]/)||n.match(/<[^\/]*?>$/)&&l.match(/^<\//)?(dt("\n"+at+Et+"\n"+at,function(){vt(i+at.length+kt.tabSize.length+1,bt)}),V.scroll(),!1):(dt("\n"+at),V.scroll(),!1)}var ct={"'":m,'"':x,"---":C,"--":k,"...":$,"|":y,"(c)":E,"(C)":E,"(p)":T,"(P)":T,"(sm)":L,"(SM)":L," sm":L," SM":L,"(tm)":O,"(TM)":O," tm":O," TM":O,"(r)":_,"(R)":_,"+-":H,"-+":H,x:R,"/":w,"^":N,"<<":B,">>":S,"<":M,">":A,"<=":I,">=":U,"!=":z,".":Q};if(r.length){if(f){ht(/'([^']*?)'/g,v+"$1"+m,j),ht(/"([^"]*?)"/g,b+"$1"+x,j);for(var h in ct)ht(RegExp(g(h),"g"),ct[h],j);return bt(),!1}}else{if(f){if(-1!==n.indexOf('"')&&'"'==l[0])return ft.value=n.replace(/"([^"]*?)$/,b+"$1")+x+l.slice(1),vt(o,bt),!1;if(-1!==n.indexOf("'")&&"'"==l[0])return ft.value=n.replace(/'([^']*?)$/,v+"$1")+m+l.slice(1),vt(o,bt),!1;if(n.slice(-2).match(/\w'$/i))return ft.value=n.slice(0,-1)+m+l,vt(o,bt),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==l[0]){var ut=n.match(/\((sm|tm)$/i)?2:1;return ft.value=n.slice(0,-(ut+1))+ct["("+n.slice(-ut).toLowerCase()+")"]+l.slice(1),vt(o-ut,bt),!1}var st=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),xt=l.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==st.indexOf("<<")&&0===xt.indexOf(">>"))return ft.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,B+"$1")+l.replace(/^(?:>>|&gt;&gt;)/,S),vt(st.length-1,bt),!1;if(-1!==st.indexOf("<")&&0===xt.indexOf(">"))return ft.value=n.replace(/(?:<|&lt;)([^<]*)$/,M+"$1")+l.replace(/^(?:>|&gt;)/,A),vt(st.length,bt),!1;for(var h in ct)if(n.slice(-h.length)==h)return ft.value=n.slice(0,-h.length)+ct[h]+l,vt(i-h.length+1,bt),!1;if(37==a)return dt(K),!1;if(38==a)return dt(P),!1;if(39==a)return dt(D),!1;if(40==a)return dt(q),!1}if(8==a){var nt=" *("+yt+"|"+$t+"|> )";if(n.match(RegExp(nt+"$")))return gt(nt,1,!0),!1;if(n.match(RegExp(Et+"$")))return gt(kt.tabSize),!1;if(n.match(/<\/?[^>]*?>$/))return gt("</?[^>]*?>",1,!0),!1;switch(n.slice(-1)){case"(":return wt("(",")"),!1;case"{":return wt("{","}"),!1;case"[":return wt("[","]"),!1;case'"':return wt('"','"'),!1;case"'":return wt("'","'"),!1;case"<":return wt("<",">"),!1;case"*":return wt("*","*"),!1;case"_":return wt("_","_"),!1;case"~":return wt("~","~"),!1;case"`":return wt("`","`"),!1;case b:return wt(b,x),!1;case v:return wt(v,m),!1;case B:return wt(B,S),!1;case M:return wt(M,A),!1}}}return 39==a&&l.match(/^<\/.*?>/)?(vt(o+l.indexOf(">")+1),!1):27==a?(Ot.focus(),!1):void(f||c||u||W.setTimeout(bt,1))});var At=RegExp("(^|\\s)"+kt.areaClass+"(\\s|$)"),Bt=ft.className;Bt.match(At)||(ft.className=f(Bt+" "+kt.areaClass)),kt.ready(V),V.grip=X,V.grip.config=kt};