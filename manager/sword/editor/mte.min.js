/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.1.0
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

;var MTE=function(e,t){function f(e,t){e=e||{};for(var n in t){if(typeof t[n]==="object"){e[n]=f(e[n],t[n])}else{e[n]=t[n]}}return e}var n=this,r=window,i=document,s=new Editor(e),o={tabSize:"    ",toolbar:true,shortcut:false,toolbarClass:"editor-toolbar",toolbarPosition:"before",iconClassPrefix:"fa fa-",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",bold:"Bold",italic:"Italic",code:"Code",quote:"Quote",heading:"H1 \u2013 H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompt:{link_title:"link title goes here...",link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholder:{heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){}};var u=i.createElement("div"),a=i.createElement("div");n.modal=function(e,t){e=e||"modal";var n=i.body;u.className="custom-modal-overlay custom-"+e+"-overlay";a.className="custom-modal custom-"+e;a.innerHTML='<div class="custom-modal-header custom-'+e+'-header"></div><div class="custom-modal-content custom-'+e+'-content"></div><div class="custom-modal-action custom-'+e+'-action"></div>';n.appendChild(u);n.appendChild(a);if(typeof t=="function")t(u,a)};n.close=function(e){if(u)i.body.removeChild(u);if(a)i.body.removeChild(a);if(typeof e!="undefined"&&e===true){var t=s.selection();s.select(t.start,t.end)}};n.prompt=function(e,t,r,s){n.modal("prompt",function(o,u){var a=function(e){if(typeof s=="function"){n.close();s(e)}else{n.close(true)}};var f=i.createElement("input");f.type="text";f.value=t;f.onkeyup=function(e){if(r){if(e.keyCode==13&&this.value!==""&&this.value!==t)a(this.value)}else{if(e.keyCode==13)a(this.value==t?"":this.value)}};var c=i.createElement("button");c.innerHTML=l.buttons.ok;c.onclick=function(){if(r){if(f.value!==""&&f.value!==t)a(f.value)}else{a(f.value==t?"":f.value)}};var h=i.createElement("button");h.innerHTML=l.buttons.cancel;h.onclick=function(){n.close(true)};u.children[0].innerHTML=e?e:"";u.children[1].appendChild(f);u.children[2].appendChild(c);u.children[2].appendChild(i.createTextNode(" "));u.children[2].appendChild(h);f.select()})};n.alert=function(e,t,r){n.modal("alert",function(s,o){var u=i.createElement("button");u.innerHTML=l.buttons.ok;u.onclick=function(){if(typeof r=="function"){n.close();r()}else{n.close(true)}};o.children[0].innerHTML=e?e:"";o.children[1].innerHTML=t?t:"";o.children[2].appendChild(u)})};n.confirm=function(e,t,r){n.modal("confirm",function(s,o){var u=i.createElement("button");u.innerHTML=l.buttons.ok;u.onclick=function(){if(typeof r=="undefined"){n.close(true)}else{if(typeof r.OK=="function"){n.close();r.OK()}else{n.close(true)}}};var a=i.createElement("button");a.innerHTML=l.buttons.cancel;a.onclick=function(){if(typeof r=="undefined"){n.close(true)}else{if(typeof r.CANCEL=="function"){n.close();r.CANCEL()}else{n.close(true)}}return false};o.children[0].innerHTML=e?e:"";o.children[1].innerHTML=t?t:"";o.children[2].appendChild(u);o.children[2].appendChild(i.createTextNode(" "));o.children[2].appendChild(a)})};var l=f(o,t),c=i.createElement("span");if(l.toolbar){c.className=l.toolbarClass;s.area.parentNode.insertBefore(c,l.toolbarPosition=="before"?s.area:null)}n.button=function(e,t){if(t.title===false)return;var r=i.createElement("a");r.href="#"+e;r.innerHTML='<i class="'+l.iconClassPrefix+e+'"></i>';r.onclick=function(r){t.click(r,n);l.click(r,n,e);return false};if(t.title)r.title=t.title;if(t.position){c.insertBefore(r,c.children[t.position-1])}else{c.appendChild(r)}};s.toggle=function(e,t,n){var r=s.selection();if(r.before.slice(-e.length)!=e&&r.after.slice(0,t.length)!=t){s.wrap(e,t)}else{var i=r.before.slice(-e.length)==e?r.before.substring(0,r.before.length-e.length):r.before,o=r.after.substring(0,t.length)==t?r.after.substring(t.length):r.after;s.area.value=i+r.value+o;s.select(i.length,i.length+r.value.length,function(){s.updateHistory()})}if(typeof n=="function")n()};var h=0,p=o.buttons;var d={bold:{title:p.bold,click:function(){s.toggle("**","**")}},italic:{title:p.italic,click:function(){s.toggle("_","_")}},code:{title:p.code,click:function(){var e=s.selection().value;if(e.indexOf("\n")!==-1&&e.length>0){s.indent(l.tabSize)}else{s.toggle("`","`")}}},"quote-right":{title:p.quote,click:function(){s.indent("> ")}},"sort-amount-desc":{title:p.heading,click:function(){var e=s.selection(),t=["","# ","## ","### ","#### ","##### ","###### "];h=h<t.length-1?h+1:0;if(e.value.length>0){if(!e.before.match(/\#+ $/)){s.wrap(t[h],"",function(){s.replace(/^\#+ /,"")})}else{var n=e.before.replace(/\#+ $/,""),r=e.value.replace(/^\#+ /,"");s.area.value=n+t[h]+r+e.after;s.select(n.length+t[h].length,n.length+t[h].length+r.length,function(){s.updateHistory()})}}else{var i=l.placeholder.heading_text;h=1;s.insert(t[h]+i,function(){e=s.selection().end;s.select(e-i.length-t[h].length+2,e,function(){s.updateHistory()})})}}},link:{title:p.link,click:function(){var e=s.selection(),t,r,i=l.placeholder.link_text;n.prompt(l.prompt.link_title_title,l.prompt.link_title,false,function(o){t=o;n.prompt(l.prompt.link_url_title,l.prompt.link_url,true,function(n){r=n;s.wrap("["+(e.value.length===0?i:""),"]("+r+(t!==""?' "'+t+'"':"")+")",function(){s.select(e.start+1,e.value.length===0?e.start+i.length+1:e.end+1,function(){s.updateHistory()})})})})}},image:{title:p.image,click:function(){n.prompt(l.prompt.image_url_title,l.prompt.image_url,true,function(e){var t=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[\-\+\.\_]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});t=t.indexOf("/")===-1&&e.indexOf(".")!==-1?t:l.placeholder.image_alt;s.insert("\n!["+t+"]("+e+")\n")})}},"list-ol":{title:p.ol,click:function(){var e=s.selection(),t=0,n="";if(e.value==l.placeholder.list_ol_text){s.select(e.start,e.end)}else{if(e.value.length>0){s.indent("",function(){s.replace(/^[^\n\r]/gm,function(e){t++;n+=" "+t+". ";return e.replace(/^/," "+t+". ")})})}else{var r=" 1. "+l.placeholder.list_ol_text;s.insert(r,function(){s.select(e.start+4,e.start+r.length,function(){s.updateHistory()})})}}}},"list-ul":{title:p.ul,click:function(){var e=s.selection();if(e.value==l.placeholder.list_ul_text){s.select(e.start,e.end)}else{if(e.value.length>0){s.indent(" * ")}else{var t=" * "+l.placeholder.list_ul_text;s.insert(t,function(){s.select(e.start+3,e.start+t.length,function(){s.updateHistory()})})}}}},"ellipsis-h":{title:p.rule,click:function(){s.insert("\n---\n")}},"rotate-left":{title:p.undo,click:function(){s.undo()}},"rotate-right":{title:p.redo,click:function(){s.redo()}}};for(var v in d)n.button(v,d[v]);var m=function(e,t){s.insert(e,function(){s.select(t.end+1,t.end+1)});return false};s.area.onkeydown=function(e){var t=s.selection(),i=e.keyCode,u=e.ctrlKey,a=e.shiftKey,f=e.altKey;r.setTimeout(function(){l.keydown(e,n)},10);var c=t.before,h=t.after[0];if(c.indexOf("(")!==-1&&a&&i==48&&h==")"&&c.slice(-1)!="\\"||c.indexOf("{")!==-1&&a&&i==221&&h=="}"&&c.slice(-1)!="\\"||c.indexOf("[")!==-1&&i==221&&h=="]"&&c.slice(-1)!="\\"||c.indexOf('"')!==-1&&a&&i==222&&h=='"'&&c.slice(-1)!="\\"||c.indexOf("'")!==-1&&!a&&i==222&&h=="'"&&c.slice(-1)!="\\"||c.indexOf("`")!==-1&&!a&&i==192&&h=="`"&&c.slice(-1)!="\\"||c.indexOf("<")!==-1&&a&&i==190&&h==">"&&c.slice(-1)!="\\"){s.select(t.end+1,t.end+1);return false}if(a&&i==57){return m("("+t.value+")",t)}if(a&&i==219){return m("{"+t.value+"}",t)}if(!a&&i==219){return m("["+t.value+"]",t)}if(a&&i==222){return m('"'+t.value+'"',t)}if(!a&&i==222){return m("'"+t.value+"'",t)}if(!a&&i==192){return m("`"+t.value+"`",t)}if(a&&i==188){return m("<"+t.value+">",t)}if(a&&i==9){s.outdent("( *[0-9]+. | *[\\-\\+\\*] |> |"+l.tabSize+")");return false}if(i==9){s.indent(l.tabSize);return false}if(u&&i==90){s.undo();return false}if(u&&i==89||u&&i==82){s.redo();return false}if(o.shortcut){if(u&&i==66){d.bold.click();return false}if(u&&i==73){d.italic.click();return false}if(u&&i==81){d["quote-right"].click();return false}if(f&&i==81){if(a){s.toggle("&ldquo;","&rdquo;")}else{s.toggle("&lsquo;","&rsquo;")}return false}if(u&&i==72){d["sort-amount-desc"].click();return false}if(u&&i==76){d.link.click();return false}if(u&&i==71){d.image.click();return false}}if(i==32){var p=/(^|\n)([0-9]+\.|[\-\+\*])$/;if(t.before.match(p)){s.area.value=t.before.replace(p,"$1 $2 ")+t.value+t.after;s.select(t.end+2,t.end+2,function(){s.updateHistory()});return false}}if(i==13){var v=/(^|\n)( *?)([0-9]+\.|[\-\+\*]) (.*?)$/;if(t.before.match(v)){var g=v.exec(t.before),y=/[0-9]+\./.test(g[3])?parseInt(g[3],10)+1+".":g[3];s.insert("\n"+g[2]+y+" ",null);return false}var b=(new RegExp("(^|\n)(("+l.tabSize+")+)(.*?)$")).exec(t.before),w=b?b[2]:"";if(t.before.match(/[\(\{\[]$/)&&t.after.match(/^[\]\}\)]/)||t.before.match(/<[^\/]*?>$/)&&t.after.match(/^<\//)){s.insert("\n"+w+l.tabSize+"\n"+w,function(){s.select(t.start+w.length+l.tabSize.length+1,t.start+w.length+l.tabSize.length+1,function(){s.updateHistory()})});return false}s.insert("\n"+w);return false}if(i==8){if(t.value.length===0){if(t.before.match(/( *?)([0-9]+\.|[\-\+\*]) $/)){s.outdent("( *?)([0-9]+.|[-+*]) ");return false}if(t.before.match(new RegExp(l.tabSize+"$"))){s.outdent(l.tabSize);return false}switch(t.before.slice(-1)){case"(":s.toggle("(",")");return false;break;case"{":s.toggle("{","}");return false;break;case"[":s.toggle("[","]");return false;break;case'"':s.toggle('"','"');return false;break;case"'":s.toggle("'","'");return false;break;case"<":s.toggle("<",">");return false;break;case"*":s.toggle("*","*");return false;break;case"_":s.toggle("_","_");return false;break;case"~":s.toggle("~","~");return false;break;case"`":s.toggle("`","`");return false;break}}}s.updateHistory()};l.ready(n);n.grip=s};