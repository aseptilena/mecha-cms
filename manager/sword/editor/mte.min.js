/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.3.0
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var MTE=function(e,t){function n(e){return void 0!==e}function l(e){return"string"==typeof e}function r(e){return"number"==typeof e}function i(e){return"function"==typeof e}function o(e){return"object"==typeof e}function a(e,t,n){return t="on"+t,null===n?e[t]=null:(i(e[t])&&(n=function(e,t){return function(){return e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),void(e[t]=n))}function c(e,t){e=e||{};for(var n in t)e[n]=o(t[n])?c(e[n],t[n]):t[n];return e}function u(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),l=0;return l=W.defaultView&&W.defaultView.getComputedStyle?W.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function s(e,t){return dt(e,function(){mt(t.end+1,bt)}),!1}function f(e){return e.replace(/^\s+|\s+$/g,"")}function p(e){return e.replace(/^\s+/,"")}function d(e){return e.replace(/\s+$/,"")}function g(e){return e.replace(F.escape,"\\$1")}function h(e){return e.parentNode}var m="\u2018",v="\u2019",b="\u201C",x="\u201D",k="\u2013",C="\u2014",E="\u2026",y="\u00A6",$="\u00A9",T="\u2117",L="\u2120",R="\u2122",H="\u00AE",O="\u00B1",S="\u00D7",_="\u00F7",w="\u00B0",N="\u2039",M="\u203A",I="\u00AB",z="\u00BB",U="\u2264",B="\u2265",A="\u2260",P="\u2190",K="\u2192",q="\u2191",D="\u2193",Y="\u21B5",G="\u00B7",Q=this,V=window,W=document,F=new Editor(e),X={tabSize:"    ",toolbar:!0,shortcut:!1,areaClass:"editor-area",toolbarClass:"editor-toolbar",toolbarIconClass:"fa fa-%s",toolbarButtonClass:"editor-toolbar-button editor-toolbar-button-%s",toolbarSeparatorClass:"editor-toolbar-separator",toolbarPosition:"before",dropClass:"custom-drop custom-%s-drop",modalClass:"custom-modal custom-modal-%s",modalHeaderClass:"custom-modal-header custom-modal-%s-header",modalContentClass:"custom-modal-content custom-modal-%s-content",modalFooterClass:"custom-modal-action custom-modal-%s-action",modalOverlayClass:"custom-modal-overlay custom-modal-%s-overlay",closeATXHeaders:!1,STRONG:"**",EM:"_",UL:"- ",OL:"%d. ",HR:"---",CODE:"`",PRE:"    ",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",code:"Code",quote:"Quote",heading:"H1 "+k+" H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here"+E,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here"+E,heading_text:"Heading",link_text:"link text",list_ul_text:"List item",list_ol_text:"List item",image_alt:"Image"},update:function(){},keydown:function(){},click:function(){},ready:function(){},copy:function(){},cut:function(){},paste:function(){}},j=W.body,J=W.createElement("div"),Z=W.createElement("div"),et=W.createElement("div"),tt=0,nt=null,lt=null,rt=0,it=0,ot=0,at=0,ct=j.parentNode.offsetWidth,ut=V.innerHeight>j.parentNode.offsetHeight?V.innerHeight:j.parentNode.offsetHeight,st=function(){},ft=e,pt=F.indent,dt=F.insert,gt=F.outdent,ht=F.replace,mt=F.select,vt=F.selection,bt=F.updateHistory,xt=F.wrap,kt=c(X,t),Ct=W.createElement("span"),Et=g(kt.UL).replace(/\\[-+*]/g,"[-+*]"),yt=g(kt.OL).replace(/%d/g,"[0-9]+"),$t=g(kt.tabSize),Tt=g(kt.PRE);Q.event=function(e,t,n){return a(t,e,n)},Q.modal=function(e,t,n){i(e)&&(n=t,t=e,e="default"),e=e||"default",n=n||{},tt=j.scrollTop||j.parentNode.scrollTop,J.className=kt.modalOverlayClass.replace(/%s/g,e),Z.className=kt.modalClass.replace(/%s/g,e),Z.innerHTML='<div class="'+kt.modalHeaderClass.replace(/%s/g,e)+'"></div><div class="'+kt.modalContentClass.replace(/%s/g,e)+'"></div><div class="'+kt.modalFooterClass.replace(/%s/g,e)+'"></div>';var l=Z.style,r="left"in n,o="top"in n;l.visibility="hidden",j.appendChild(J),j.appendChild(Z),V.setTimeout(function(){var e=Z.offsetWidth,t=Z.offsetHeight;l.position="absolute",l.left=r?n.left+"px":"50%",l.top=o?n.top+"px":"50%",l.zIndex="9999",l.marginLeft=(r?0:0-e/2)+"px",l.marginTop=(o?0:tt-t/2)+"px",l.visibility="",Z.offsetLeft<0&&!r&&(l.left=0,l.marginLeft=0,r=!0,n.left=0),Z.offsetTop<0&&!o&&(l.top=0,l.marginTop=0,o=!0,n.top=0);var i=Z.children[0];a(i,"mousedown",function(){return lt=Z,ot=rt-lt.offsetLeft,at=it-lt.offsetTop,!1}),a(j,"mousemove",null),a(j,"mousemove",function(n){rt=n.pageX,it=n.pageY+tt;var i,a,c=r?0:e/2,u=o?0:t/2;if(null!==lt){var s=r?e:0,f=o?t:0;i=rt-ot+c,a=it-at+u,c>i&&(i=c),u>a&&(a=u),i+c+s>ct&&(i=ct-c-s),a+u+f>ut&&(a=ut-u-f),l.left=i+"px",l.top=a-tt+"px"}})},10),i(t)&&t(J,Z)},Q.drop=function(e,t,n){i(e)&&(n=t,t=e,e="default"),!n&&nt&&(n={left:nt.offsetLeft,top:nt.offsetTop+nt.offsetHeight}),e=e||"default",n=n||{},tt=j.scrollTop||j.parentNode.scrollTop,et.className=kt.dropClass.replace(/%s/g,e);var l=et.style,r="left"in n,o="top"in n;l.visibility="hidden",j.appendChild(et),V.setTimeout(function(){var e=et.offsetWidth,t=et.offsetHeight;l.position="absolute",l.left=r?n.left+"px":"50%",l.top=o?n.top+"px":"50%",l.zIndex="9999",l.marginLeft=(r?0:0-e/2)+"px",l.marginTop=(o?0:tt-t/2)+"px",l.visibility="",n.left+e>ct&&(l.left=ct-e+"px",l.marginLeft=0),n.top+t>ut&&(l.top=ut-t+"px",l.marginTop=0)},10),i(t)&&t(et)},Q.prompt=function(e,t,n,l,r){Q.modal("prompt",function(r,o){var c=function(e){i(l)?(Q.close(),l(e)):Q.close(!0)},u=W.createElement("input");u.type="text",u.value=t,a(u,"keydown",function(e){var l=e.keyCode;if(27==l)return Q.close(!0),!1;if(40==l)return s.focus(),!1;if(n){if(13==l&&""!==this.value&&this.value!==t)return c(this.value),!1}else if(13==l)return c(this.value==t?"":this.value),!1});var s=W.createElement("button");s.innerHTML=kt.buttons.ok,a(s,"click",function(){return n?""!==u.value&&u.value!==t&&c(u.value):c(u.value==t?"":u.value),!1});var f=W.createElement("button");f.innerHTML=kt.buttons.cancel,a(f,"click",function(){return Q.close(!0),!1}),a(s,"keydown",function(e){var t=e.keyCode;return 27==t?(Q.close(!0),!1):38==t?(u.focus(),!1):39==t?(f.focus(),!1):void 0}),a(f,"keydown",function(e){var t=e.keyCode;return 27==t?(Q.close(!0),!1):37==t?(s.focus(),!1):38==t?(u.focus(),!1):void 0}),o.children[0].innerHTML=e?e:"",o.children[1].appendChild(u),o.children[2].appendChild(s),o.children[2].appendChild(W.createTextNode(" ")),o.children[2].appendChild(f),V.setTimeout(function(){u.select()},10)},r)},Q.alert=function(e,t,n,l){Q.modal("alert",function(l,r){var o=W.createElement("button");o.innerHTML=kt.buttons.ok,a(o,"click",function(){return i(n)?(Q.close(),n()):Q.close(!0),!1}),a(o,"keydown",function(e){return 27==e.keyCode?(Q.close(!0),!1):void 0}),r.children[0].innerHTML=e?e:"",r.children[1].innerHTML=t?t:"",r.children[2].appendChild(o),V.setTimeout(function(){o.focus()},10)},l)},Q.confirm=function(e,t,l,r){Q.modal("confirm",function(r,o){var c=W.createElement("button");c.innerHTML=kt.buttons.ok,a(c,"click",function(){return n(l)&&i(l.OK)?(Q.close(),l.OK()):Q.close(!0),!1});var u=W.createElement("button");u.innerHTML=kt.buttons.cancel,a(u,"click",function(){return n(l)&&i(l.CANCEL)?(Q.close(),l.CANCEL()):Q.close(!0),!1}),a(c,"keydown",function(e){var t=e.keyCode;return 27==t?(Q.close(!0),!1):39==t?(u.focus(),!1):void 0}),a(u,"keydown",function(e){var t=e.keyCode;return 27==t?(Q.close(!0),!1):37==t?(c.focus(),!1):void 0}),o.children[0].innerHTML=e?e:"",o.children[1].innerHTML=t?t:"",o.children[2].appendChild(c),o.children[2].appendChild(W.createTextNode(" ")),o.children[2].appendChild(u),V.setTimeout(function(){u.focus()},10)},r)},Q.close=function(e){if(nt=null,lt=null,h(J)&&j.removeChild(J),h(Z)&&j.removeChild(Z),h(et)&&j.removeChild(et),e&&e!==!1){var t=vt();o(e)||(e={}),mt("start"in e?e.start:t.start,"end"in e?e.end:t.end)}},a(V,"resize",function(){ct=j.parentNode.offsetWidth,ut=V.innerHeight>j.parentNode.offsetHeight?V.innerHeight:j.parentNode.offsetHeight}),a(j,"mouseup",function(){lt=null}),a(J,"click",function(){Q.close(!0)}),Q.scroll=function(e,t){r(e)?ft.scrollTop=e:ft.scrollTop+=parseInt(u(ft,"line-height"),10),i(t)&&t()},Q.time=function(e){var t=new Date,l=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),o=t.getHours(),a=t.getMinutes(),c=t.getSeconds(),u=t.getMilliseconds();10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>a&&(a="0"+a),10>c&&(c="0"+c),10>u&&(u="0"+u);var s={Y:""+l,m:""+r,d:""+i,H:""+o,i:""+a,s:""+c,u:""+u};return n(e)?s[e]:s},kt.toolbar&&(Ct.className=kt.toolbarClass,ft.parentNode.insertBefore(Ct,"before"==kt.toolbarPosition?ft:null));var Lt=W.createElement("a");Lt.href="#esc:"+(new Date).getTime(),Lt.style.width=0,Lt.style.height=0,ft.parentNode.appendChild(Lt),Q.button=function(e,t){if("|"===e)return Q.separator(t);if(t=t||{},t.title!==!1){var n,c=W.createElement("a");if(c.className=kt.toolbarButtonClass.replace(/%s/g,e),c.setAttribute("tabindex",-1),c.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),c.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+kt.toolbarIconClass.replace(/%s/g,e)+'"></i>',t.title&&(c.title=t.title),o(t.attr))for(var u in t.attr)if(l(t.attr[u])&&"+="==t.attr[u].slice(0,2)){var s=c.getAttribute(u)||"";c.setAttribute(u,s+t.attr[u].slice(2))}else c.setAttribute(u,t.attr[u]);a(c,"click",function(e){if(i(t.click)){var n=this.hash.replace("#","");return Q.close(),nt=c,t.click(e,Q),kt.click(e,Q,n),kt.update(e,Q,n),!1}}),a(c,"keydown",function(e){return 27==e.keyCode?(Q.close(!0),!1):void 0}),r(t.position)?(n=t.position<0?t.position+Ct.children.length+1:t.position-1,Ct.insertBefore(c,Ct.children[n]||null)):Ct.appendChild(c),X.buttons[e]=t}},Q.separator=function(e){e=e||{};var t,n=W.createElement("span");if(n.className=kt.toolbarSeparatorClass,o(e.attr))for(var i in e.attr)if(l(e.attr[i])&&"+="==e.attr[i].slice(0,2)){var a=n.getAttribute(i)||"";n.setAttribute(i,a+e.attr[i].slice(2))}else n.setAttribute(i,e.attr[i]);r(e.position)?(t=e.position<0?e.position+Ct.children.length+1:e.position-1,Ct.insertBefore(n,Ct.children[t]||null)):Ct.appendChild(n)},F.toggle=function(e,t,n,l){var r=vt();if(r.before.slice(-e.length)!=e&&r.after.slice(0,t.length)!=t)xt(e,t,0===r.value.length&&l?function(){ht(/^.*$/,l===!0?kt.placeholders.text:l)}:1);else{var o=r.before.slice(-e.length)==e?r.before.slice(0,-e.length):r.before,a=r.after.slice(0,t.length)==t?r.after.slice(t.length):r.after;ft.value=o+r.value+a,mt(o.length,o.length+r.value.length,bt)}i(n)&&n()};var Rt=F.toggle,Ht=0,Ot=kt.buttons,St={bold:{title:Ot.bold,click:function(){var e=kt.STRONG;Rt(e,e,1,!0)}},italic:{title:Ot.italic,click:function(){var e=kt.EM;Rt(e,e,1,!0)}},code:{title:Ot.code,click:function(){var e=vt().value,t=kt.CODE,n=kt.PRE;if(-1!==e.indexOf("\n")&&e.length>0)if(-1===n.indexOf("%s")){var l="("+Tt+"|\\t| {4})";F[e.match(RegExp("^"+l))?"outdent":"indent"](n)}else{var r=n.split("%s");Rt(r[0],r[1]||r[0])}else Rt(t,t,1,!0)}},"quote-right":{title:Ot.quote,click:function(){var e,t=vt(),n=d(t.before),l=f(t.value),r=p(t.after),i=n.length>0?"\n\n":"",o=kt.placeholders.text;l==o?mt(t.start,t.end):l.length>0?F[">"==l[0]?"outdent":"indent"]("> "):(ft.value=n+i+"> "+o+"\n\n"+r,e=n.length+i.length+2,mt(e,e+o.length,bt))}},header:{title:Ot.heading,click:function(){var e,t=vt(),n=["","=","-","###","####","#####","######"],l=d(t.before.replace(/#+ $/,"")),r=f(t.value.replace(/#+ | #+|\n+[-=]+/g,"").replace(/\n+/g," ")),i=p(t.after.replace(/^( #+|\n+[-=]+)/g,"")),o=l.length>0?"\n\n":"";if(Ht=Ht<n.length-1?Ht+1:0,t.value.length>0)if(Ht>0&&3>Ht)ft.value=l+o+r+"\n"+r.replace(/./g,n[Ht])+"\n\n"+i,e=l.length+o.length,mt(e,e+r.length,bt);else{var a=Ht>0?" ":"";ft.value=l+o+n[Ht]+a+r+(kt.closeATXHeaders?a+n[Ht]:"")+"\n\n"+i,e=l.length+o.length+n[Ht].length+a.length,mt(e,e+r.length,bt)}else{var c=kt.placeholders.heading_text;Ht=1,ft.value=l+o+c+"\n"+c.replace(/./g,n[Ht])+"\n\n"+i,e=l.length+o.length,mt(e,e+c.length,bt)}}},link:{title:Ot.link,click:function(e){var t,n,l=vt(),r=kt.placeholders.link_text;Q.prompt(kt.prompts.link_url_title,kt.prompts.link_url,!0,function(i){n=i,Q.prompt(kt.prompts.link_title_title,kt.prompts.link_title,!1,function(i){t=i.replace(/'/g,"&apos;").replace(/"/g,"&quot;"),xt("[","]("+n+(""!==t?' "'+t+'"':"")+")",0===l.value.length?function(){ht(/^/,r)}:1),kt.update(e,Q)})})}},image:{title:Ot.image,click:function(e){Q.prompt(kt.prompts.image_url_title,kt.prompts.image_url,!0,function(t){var n=vt(),l=d(n.before),r=p(n.after),i=l.length>0?"\n\n":"",o=decodeURIComponent(t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});o=-1===o.indexOf("/")&&-1!==t.indexOf(".")?o:kt.placeholders.image_alt,ft.value=l+i+"!["+o+"]("+t+")\n\n"+r,mt(l.length+i.length+2+o.length+2+t.length+3,function(){kt.update(e,Q),bt()})})}},"list-ol":{title:Ot.ol,click:function(){var e=vt(),t=kt.placeholders.list_ol_text,n=0;if(e.value.length>0)e.value==t?mt(e.start,e.end):e.value.match(RegExp("^ *"+yt))?gt(" *"+yt,1,!0):pt("",function(){ht(RegExp("(^|\\n) *"+Et+" *","g"),"$1",st),ht(/^[^\n]/gm,function(e){return n++,e.replace(/^/," "+kt.OL.replace(/%d/g,n))})});else if(e.before.match(/(^|\n{2,})$/)){var l=e.before.length>0?"\n\n":"",r=" "+kt.OL.replace(/%d/g,1),i=d(e.before),o=i.length+l.length;t=r+t,ft.value=i+l+t+e.after,mt(o+r.length,o+t.length,bt)}else{var a=RegExp("(^|\\n) *"+yt+"(.*?)$"),i=e.before.replace(a,"$1$2");if(e.before.match(a))ft.value=i+e.after,mt(i.length,bt);else{var c=RegExp("(?:^|\\n) *("+yt+").*?\n.*?$").exec(e.before),r=" "+kt.OL.replace(/%d/g,c&&c[1]?parseInt(c[1],10)+1:1);e.before=e.before.replace(RegExp("(^|\\n) *"+Et+"(.*?)$"),"$1$2").replace(/(^|\n)(.*?)$/,"$1"+r+"$2"),ft.value=e.before+e.after,mt(e.before.length,bt)}}}},"list-ul":{title:Ot.ul,click:function(){var e=vt(),t=kt.placeholders.list_ul_text,n=" "+kt.UL;if(e.value.length>0)e.value==t?mt(e.start,e.end):(ht(RegExp("(^|\\n) *"+yt+" *","g"),"$1",st),F[e.value.match(RegExp("^ *"+Et))?"outdent":"indent"](n));else if(e.before.match(/(^|\n{2,})$/)){var l=e.before.length>0?"\n\n":"",r=d(e.before),i=r.length+l.length;t=n+t,ft.value=r+l+t+e.after,mt(i+n.length,i+t.length,bt)}else{var o=RegExp("(^|\\n) *"+Et+"(.*?)$"),r=e.before.replace(o,"$1$2");e.before.match(o)?(ft.value=r+e.after,mt(r.length,bt)):(e.before=e.before.replace(RegExp("(^|\\n) *"+yt+"(.*?)$"),"$1$2").replace(/(^|\n) *(.*?)$/,"$1"+n+"$2"),ft.value=e.before+e.after,mt(e.before.length,bt))}}},"ellipsis-h":{title:Ot.rule,click:function(){var e=vt(),t=d(e.before),n=p(e.after),l=t.length>0?"\n\n":"";ft.value=t+l+kt.HR+"\n\n"+n,mt(t.length+l.length+kt.HR.length+2,bt)}},undo:{title:Ot.undo,click:F.undo},repeat:{title:Ot.redo,click:F.redo}};for(var _t in St)Q.button(_t,St[_t]);a(ft,"focus",Q.close),a(ft,"copy",function(e){var t=vt();V.setTimeout(function(){kt.copy(t),kt.update(e,Q)},1)}),a(ft,"cut",function(e){var t=vt();V.setTimeout(function(){t.end=t.start,kt.cut(t),kt.update(e,Q),bt()},1)}),a(ft,"paste",function(e){var t=vt();V.setTimeout(function(){t.end=vt().end,t.value=ft.value.substring(t.start,t.end),kt.paste(t),kt.update(e,Q),bt()},1)}),a(ft,"keydown",function(e){var t=vt(),n=t.before,l=t.value,r=t.after,i=t.start,o=t.end,a=e.keyCode,c=e.ctrlKey,u=e.shiftKey,f=e.altKey,p=9==a;V.setTimeout(function(){kt.keydown(e,Q),kt.update(e,Q)},1);var h=n,W=r[0],X="\\"==h.slice(-1);if(-1!==h.indexOf("(")&&u&&48==a&&")"==W&&!X||-1!==h.indexOf("{")&&u&&221==a&&"}"==W&&!X||-1!==h.indexOf("[")&&221==a&&"]"==W&&!X||-1!==h.indexOf('"')&&u&&222==a&&'"'==W&&!X||-1!==h.indexOf("'")&&!u&&222==a&&"'"==W&&!X||-1!==h.indexOf("`")&&!u&&192==a&&"`"==W&&!X||-1!==h.indexOf("<")&&u&&190==a&&">"==W&&!X)return mt(o+1),!1;if(u&&57==a&&!X)return s("("+l+")",t);if(u&&219==a&&!X)return s("{"+l+"}",t);if(!u&&219==a&&!X)return s("["+l+"]",t);if(u&&222==a&&!X)return s('"'+l+'"',t);if(!u&&222==a&&!X)return s("'"+l+"'",t);if(!u&&192==a&&!X)return s("`"+l+"`",t);if(u&&188==a&&!X)return s("<"+l+">",t);if(u&&p)return gt("( *"+yt+"| *"+Et+"|> *|"+$t+")",1,!0),!1;if(p){if(n.match(/<[^\/>]*?$/)&&">"==r[0]){var j=/<([^\/>]*?)$/.exec(n);return ft.value=n+" "+l+"></"+j[1].split(" ")[0]+r,mt(i+1,bt),!1}return pt(kt.tabSize),!1}if(c&&90==a)return F.undo(),!1;if(c&&89==a)return F.redo(),!1;if(kt.shortcut){if(c&&66==a)return St.bold.click(),!1;if(c&&71==a)return St.image.click(),!1;if(c&&72==a)return St.header.click(),!1;if(c&&73==a)return St.italic.click(),!1;if(c&&!u&&75==a)return St.code.click(),!1;if(c&&76==a)return St.link.click(),!1;if(c&&81==a)return St["quote-right"].click(),!1;if(c&&82==a)return St["ellipsis-h"].click(),!1;if(c&&49==a)return St["list-ol"].click(),!1;if(c&&173==a)return St["list-ul"].click(),!1}if(32==a){var j="(^|\\n)("+d(yt)+"|"+d(Et)+")";if(n.match(RegExp(j+"$")))return ft.value=n.replace(RegExp(j+"$"),"$1 $2 ")+l+r,mt(o+2,bt),!1}if(13==a){if(f&&0===l.length)return dt(Y),!1;var J=RegExp("(?:^|\\n)( *)("+yt+"|"+Et+"|> )( *)(.*?)$");if(n.match(J)){var Z=J.exec(n),et=RegExp(yt).test(Z[2])?kt.OL.replace(/%d/g,parseInt(Z[2],10)+1):Z[2];return dt("\n"+Z[1]+et+Z[3],1),Q.scroll(),!1}var tt=RegExp("(?:^|\\n)(("+$t+")+)(.*?)$").exec(n),nt=tt?tt[1]:"";return n.match(/[\(\{\[]$/)&&r.match(/^[\]\}\)]/)||n.match(/<[^\/]*?>$/)&&r.match(/^<\//)?(dt("\n"+nt+$t+"\n"+nt,function(){mt(i+nt.length+kt.tabSize.length+1,bt)}),Q.scroll(),!1):(dt("\n"+nt),Q.scroll(),!1)}var lt={"'":v,'"':x,"---":C,"--":k,"...":E,"|":y,"(c)":$,"(C)":$,"(p)":T,"(P)":T,"(sm)":L,"(SM)":L," sm":L," SM":L,"(tm)":R,"(TM)":R," tm":R," TM":R,"(r)":H,"(R)":H,"+-":O,"-+":O,x:S,"/":_,"^":w,"<<":I,">>":z,"<":N,">":M,"<=":U,">=":B,"!=":A,".":G};if(l.length>0){if(f){ht(/'([^']*?)'/g,m+"$1"+v,st),ht(/"([^"]*?)"/g,b+"$1"+x,st);for(var rt in lt)ht(RegExp(g(rt),"g"),lt[rt],st);return bt(),!1}}else{if(f){if(-1!==n.indexOf('"')&&'"'==r[0])return ft.value=n.replace(/"([^"]*?)$/,b+"$1")+x+r.slice(1),mt(o,bt),!1;if(-1!==n.indexOf("'")&&"'"==r[0])return ft.value=n.replace(/'([^']*?)$/,m+"$1")+v+r.slice(1),mt(o,bt),!1;if(n.slice(-2).match(/\w'$/i))return ft.value=n.slice(0,-1)+v+r,mt(o,bt),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==r[0]){var it=n.match(/\((sm|tm)$/i)?2:1;return ft.value=n.slice(0,-(it+1))+lt["("+n.slice(-it).toLowerCase()+")"]+r.slice(1),mt(o-it,bt),!1}var ot=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),at=r.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==ot.indexOf("<<")&&0===at.indexOf(">>"))return ft.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,I+"$1")+r.replace(/^(?:>>|&gt;&gt;)/,z),mt(ot.length-1,bt),!1;if(-1!==ot.indexOf("<")&&0===at.indexOf(">"))return ft.value=n.replace(/(?:<|&lt;)([^<]*)$/,N+"$1")+r.replace(/^(?:>|&gt;)/,M),mt(ot.length,bt),!1;for(var rt in lt)if(n.slice(-rt.length)==rt)return ft.value=n.slice(0,-rt.length)+lt[rt]+r,mt(i-rt.length+1,bt),!1;if(37==a)return dt(P),!1;if(38==a)return dt(q),!1;if(39==a)return dt(K),!1;if(40==a)return dt(D),!1}if(8==a){var j=" *("+yt+"|"+Et+"|> )";if(n.match(RegExp(j+"$")))return gt(j,1,!0),!1;if(n.match(RegExp($t+"$")))return gt(kt.tabSize),!1;if(n.match(/<\/?[^>]*?>$/))return gt("</?[^>]*?>",1,!0),!1;switch(n.slice(-1)){case"(":return Rt("(",")"),!1;case"{":return Rt("{","}"),!1;case"[":return Rt("[","]"),!1;case'"':return Rt('"','"'),!1;case"'":return Rt("'","'"),!1;case"<":return Rt("<",">"),!1;case"*":return Rt("*","*"),!1;case"_":return Rt("_","_"),!1;case"~":return Rt("~","~"),!1;case"`":return Rt("`","`"),!1;case b:return Rt(b,x),!1;case m:return Rt(m,v),!1;case I:return Rt(I,z),!1;case N:return Rt(N,M),!1}}}return 39==a&&r.match(/^<\/.*?>/)?(mt(o+r.indexOf(">")+1),!1):27==a?(Lt.focus(),!1):void(f||c||u||V.setTimeout(bt,1))});var wt=RegExp("(^|\\s)"+kt.areaClass+"(\\s|$)"),Nt=ft.className;Nt.match(wt)||(ft.className=f(Nt+" "+kt.areaClass)),kt.ready(Q),Q.grip=F,Q.grip.config=kt};