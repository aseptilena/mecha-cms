/*!
 * ----------------------------------------------------------
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.0
 * ----------------------------------------------------------
 * Author: Taufik Nurrohman <http://latitudu.com>
 * Licensed under the MIT license.
 *
 * REQUIRES:
 * ==========================================================
 * [1]. https://github.com/tovic/simple-text-editor-library
 * [2]. https://fortawesome.github.io/Font-Awesome/icons
 * ==========================================================
 * ----------------------------------------------------------
 *
 */

var MTE=function(e,t){function n(e,t){e=e||{};for(var l in t)e[l]="object"==typeof t[l]?n(e[l],t[l]):t[l];return e}function l(e,t){var n=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),l=0;return l=B.defaultView&&B.defaultView.getComputedStyle?B.defaultView.getComputedStyle(e,null).getPropertyValue(t):e.style[n]}function i(e,t){return Q(e,function(){W(t.end+1,X)}),!1}function r(e){return e.replace(/^\s+|\s+$/g,"")}function o(e){return e.replace(/^\s+/,"")}function c(e){return e.replace(/\s+$/,"")}function a(e){return e.replace(A.escape,"\\$1")}void 0!==t.prompt&&(t.prompts=t.prompt),void 0!==t.placeholder&&(t.placeholders=t.placeholder);var u="\u2018",s="\u2019",f="\u201C",d="\u201D",p="\u2013",h="\u2014",g="\u2026",m="\u00A6",v="\u00A9",x="\u2117",b="\u2120",k="\u2122",y="\u00AE",C="\u00B1",E="\u00F7",_="\u00B0",L="\u2039",T="\u203A",$="\u00AB",O="\u00BB",R="\u2264",H="\u2265",M="\u2260",S="\u2190",w="\u2192",I="\u2191",N="\u2193",P="\u21B5",U=this,z=window,B=document,A=new Editor(e),K={tabSize:"    ",toolbar:!0,shortcut:!1,toolbarClass:"editor-toolbar",toolbarPosition:"before",buttonClassPrefix:"editor-toolbar-button editor-toolbar-button-",iconClassPrefix:"fa fa-",STRONG:"**",EM:"_",UL:"- ",OL:"%d. ",HR:"---",CODE:"`",PRE:"    ",buttons:{ok:"OK",yes:"Yes",no:"No",cancel:"Cancel",open:"Open",close:"Close",bold:"Bold",italic:"Italic",code:"Code",quote:"Quote",heading:"H1 "+p+" H6",link:"Link",image:"Image",ol:"Ordered List",ul:"Unordered List",rule:"Horizontal Rule",undo:"Undo",redo:"Redo"},prompts:{link_title:"link title goes here"+g,link_title_title:"Link Title",link_url:"http://",link_url_title:"Link URL",image_url:"http://",image_url_title:"Image URL"},placeholders:{text:"text goes here"+g,heading_text:"Heading",link_text:"link text",list_ul_text:"List Item",list_ol_text:"List Item",image_alt:"Image"},keydown:function(){},click:function(){},ready:function(){}},D=B.createElement("div"),q=B.createElement("div"),V=function(){},Y=e,G=A.indent,Q=A.insert,j=A.outdent,F=A.replace,W=A.select,J=A.selection,X=A.updateHistory,Z=A.wrap,et=n(K,t),tt=B.createElement("span"),nt=a(et.UL).replace(/\\[-+*]/g,"[-+*]"),lt=a(et.OL).replace(/%d/g,"[0-9]+"),it=a(et.tabSize),rt=a(et.PRE);U.modal=function(e,t){e=e||"modal";var n=B.body,l=n.scrollTop||B.documentElement.scrollTop;D.className="custom-modal-overlay custom-modal-"+e+"-overlay",D.onclick=function(){U.close(!0)},q.className="custom-modal custom-modal-"+e,q.innerHTML='<div class="custom-modal-header custom-modal-'+e+'-header"></div><div class="custom-modal-content custom-modal-'+e+'-content"></div><div class="custom-modal-action custom-modal-'+e+'-action"></div>',q.style.visibility="hidden",n.appendChild(D),n.appendChild(q),z.setTimeout(function(){var e=q.offsetWidth,t=q.offsetHeight;q.style.position="absolute",q.style.top="50%",q.style.left="50%",q.style.zIndex="9999",q.style.marginTop=l-t/2+"px",q.style.marginLeft=0-e/2+"px",q.style.visibility="",q.offsetTop<0&&(q.style.top=0,q.style.marginTop=0),q.offsetLeft<0&&(q.style.left=0,q.style.marginLeft=0)},10),"function"==typeof t&&t(D,q)},U.close=function(e){if(D&&B.body.removeChild(D),q&&B.body.removeChild(q),e&&e!==!1){var t=J();W(t.start,t.end)}},U.prompt=function(e,t,n,l){U.modal("prompt",function(i,r){var o=function(e){"function"==typeof l?(U.close(),l(e)):U.close(!0)},c=B.createElement("input");c.type="text",c.value=t,c.onkeyup=function(e){n?13==e.keyCode&&""!==this.value&&this.value!==t&&o(this.value):13==e.keyCode&&o(this.value==t?"":this.value)};var a=B.createElement("button");a.innerHTML=et.buttons.ok,a.onclick=function(){n?""!==c.value&&c.value!==t&&o(c.value):o(c.value==t?"":c.value)};var u=B.createElement("button");u.innerHTML=et.buttons.cancel,u.onclick=function(){U.close(!0)},r.children[0].innerHTML=e?e:"",r.children[1].appendChild(c),r.children[2].appendChild(a),r.children[2].appendChild(B.createTextNode(" ")),r.children[2].appendChild(u),z.setTimeout(function(){c.select()},10)})},U.alert=function(e,t,n){U.modal("alert",function(l,i){var r=B.createElement("button");r.innerHTML=et.buttons.ok,r.onclick=function(){"function"==typeof n?(U.close(),n()):U.close(!0)},i.children[0].innerHTML=e?e:"",i.children[1].innerHTML=t?t:"",i.children[2].appendChild(r)})},U.confirm=function(e,t,n){U.modal("confirm",function(l,i){var r=B.createElement("button");r.innerHTML=et.buttons.ok,r.onclick=function(){void 0===n?U.close(!0):"function"==typeof n.OK?(U.close(),n.OK()):U.close(!0)};var o=B.createElement("button");o.innerHTML=et.buttons.cancel,o.onclick=function(){return void 0===n?U.close(!0):"function"==typeof n.CANCEL?(U.close(),n.CANCEL()):U.close(!0),!1},i.children[0].innerHTML=e?e:"",i.children[1].innerHTML=t?t:"",i.children[2].appendChild(r),i.children[2].appendChild(B.createTextNode(" ")),i.children[2].appendChild(o)})},U.scroll=function(e,t){"number"==typeof e?Y.scrollTop=e:Y.scrollTop+=parseInt(l(Y,"line-height"),10),"function"==typeof t&&t()},U.time=function(e){var t=new Date,n=t.getFullYear(),l=t.getMonth()+1,i=t.getDate(),r=t.getHours(),o=t.getMinutes(),c=t.getSeconds(),a=t.getMilliseconds();10>l&&(l="0"+l),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>c&&(c="0"+c),10>a&&(a="0"+a);var u={Y:""+n,m:""+l,d:""+i,H:""+r,i:""+o,s:""+c,u:""+a};return void 0!==e?u[e]:u},et.toolbar&&(tt.className=et.toolbarClass,Y.parentNode.insertBefore(tt,"before"==et.toolbarPosition?Y:null));var ot=B.createElement("a");ot.href="#esc:"+(new Date).getTime(),ot.style.width=0,ot.style.height=0,Y.parentNode.appendChild(ot),U.button=function(e,t){if(t=t||{},t.title!==!1){var n=B.createElement("a");if(n.className=et.buttonClassPrefix+e,n.href="#"+e.replace(" ",":").replace(/[^a-z0-9\:]/gi,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,""),n.setAttribute("tabindex",-1),n.innerHTML=t.text?t.text.replace(/%s/g,e):'<i class="'+et.iconClassPrefix+e+'"></i>',n.onclick=function(e){return"function"==typeof t.click?(t.click(e,U),et.click(e,U,this.hash.replace("#","")),!1):void 0},t.title&&(n.title=t.title),t.position){var l=t.position<0?t.position+tt.children.length+1:t.position-1;tt.insertBefore(n,tt.children[l])}else tt.appendChild(n)}},A.toggle=function(e,t,n,l){var i=J();if(i.before.slice(-e.length)!=e&&i.after.slice(0,t.length)!=t)Z(e,t,0===i.value.length&&l?function(){F(/^.*$/,l===!0?et.placeholders.text:l)}:1);else{var r=i.before.slice(-e.length)==e?i.before.slice(0,-e.length):i.before,o=i.after.slice(0,t.length)==t?i.after.slice(t.length):i.after;Y.value=r+i.value+o,W(r.length,r.length+i.value.length,X)}"function"==typeof n&&n()};var ct=A.toggle,at=0,ut=et.buttons;if("object"==typeof ut){var st={bold:{title:ut.bold,click:function(){var e=et.STRONG;ct(e,e,1,!0)}},italic:{title:ut.italic,click:function(){var e=et.EM;ct(e,e,1,!0)}},code:{title:ut.code,click:function(){var e=J().value,t=et.CODE,n=et.PRE;if(-1!==e.indexOf("\n")&&e.length>0)if(-1===n.indexOf("%s")){var l="("+rt+"|\\t| {4})";A[e.match(RegExp("^"+l))?"outdent":"indent"](n)}else{var i=n.split("%s");ct(i[0],i[1]||i[0])}else ct(t,t,1,!0)}},"quote-right":{title:ut.quote,click:function(){var e,t=J(),n=c(t.before),l=r(t.value),i=o(t.after),a=n.length>0?"\n\n":"",u=l;0===l.length&&(l=et.placeholders.text),u==et.placeholders.text?W(t.start,t.end):u.length>0?A[">"==u[0]?"outdent":"indent"]("> "):(Y.value=n+a+"> "+l+"\n\n"+i,e=n.length+a.length+2,W(e,e+l.length,X))}},header:{title:ut.heading,click:function(){var e,t=J(),n=["","=","-","### ","#### ","##### ","###### "],l=c(t.before.replace(/#+ $/,"")),i=r(t.value.replace(/#+ |\n+[-=]+/,"").replace(/\n+/g," ")),a=o(t.after.replace(/^\n+[-=]+/,"")),u=l.length>0?"\n\n":"";if(at=at<n.length-1?at+1:0,t.value.length>0)at>0&&3>at?(Y.value=l+u+i+"\n"+i.replace(/./g,n[at])+"\n\n"+a,e=l.length+u.length,W(e,e+i.length,X)):(Y.value=l+u+n[at]+i+"\n\n"+a,e=l.length+u.length+n[at].length,W(e,e+i.length,X));else{var s=et.placeholders.heading_text;at=1,Y.value=l+u+s+"\n"+s.replace(/./g,n[at])+"\n\n"+a,e=l.length+u.length,W(e,e+s.length,X)}}},link:{title:ut.link,click:function(){var e,t,n=J(),l=et.placeholders.link_text;U.prompt(et.prompts.link_url_title,et.prompts.link_url,!0,function(i){t=i,U.prompt(et.prompts.link_title_title,et.prompts.link_title,!1,function(i){e=i,Z("[","]("+t+(""!==e?' "'+e+'"':"")+")",0===n.value.length?function(){F(/^/,l)}:1)})})}},image:{title:ut.image,click:function(){U.prompt(et.prompts.image_url_title,et.prompts.image_url,!0,function(e){var t=J(),n=c(t.before),l=o(t.after),i=n.length>0?"\n\n":"",r=decodeURIComponent(e.substring(e.lastIndexOf("/")+1,e.lastIndexOf(".")).replace(/[-+._]+/g," ")).toLowerCase().replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()});r=-1===r.indexOf("/")&&-1!==e.indexOf(".")?r:et.placeholders.image_alt,Y.value=n+i+"!["+r+"]("+e+")\n\n"+l,W(n.length+i.length+2+r.length+2+e.length+3,X)})}},"list-ol":{title:ut.ol,click:function(){var e=J(),t=0;if(e.value==et.placeholders.list_ol_text)W(e.start,e.end);else if(e.value.length>0)G("",function(){F(/^[^\n]/gm,function(e){return t++,e.replace(/^/," "+et.OL.replace(/%d/g,t))})});else{var n=" "+et.OL.replace(/%d/g,1),l=n+et.placeholders.list_ol_text;Q(l,function(){W(e.start+n.length,e.start+l.length,X)})}}},"list-ul":{title:ut.ul,click:function(){var e=J();if(e.value==et.placeholders.list_ul_text)W(e.start,e.end);else{var t=" "+et.UL;if(e.value.length>0)G(t);else{var n=t+et.placeholders.list_ul_text;Q(n,function(){W(e.start+t.length,e.start+n.length,X)})}}}},"ellipsis-h":{title:ut.rule,click:function(){var e=J(),t=c(e.before),n=o(e.after),l=t.length>0?"\n\n":"";Y.value=t+l+et.HR+"\n\n"+n,W(t.length+l.length+et.HR.length+2,X)}},undo:{title:ut.undo,click:function(){A.undo()}},repeat:{title:ut.redo,click:function(){A.redo()}}};for(var ft in st)U.button(ft,st[ft])}Y.oncut=function(){z.setTimeout(X,1)},Y.onpaste=function(){z.setTimeout(X,1)},Y.onkeydown=function(e){var t=J(),n=t.before,l=t.value,r=t.after,o=t.start,B=t.end,K=e.keyCode,D=e.ctrlKey,q=e.shiftKey,Z=e.altKey,tt=9==K;z.setTimeout(function(){et.keydown(e,U)},1);var rt=n,at=r[0],ut="\\"==rt.slice(-1);if(-1!==rt.indexOf("(")&&q&&48==K&&")"==at&&!ut||-1!==rt.indexOf("{")&&q&&221==K&&"}"==at&&!ut||-1!==rt.indexOf("[")&&221==K&&"]"==at&&!ut||-1!==rt.indexOf('"')&&q&&222==K&&'"'==at&&!ut||-1!==rt.indexOf("'")&&!q&&222==K&&"'"==at&&!ut||-1!==rt.indexOf("`")&&!q&&192==K&&"`"==at&&!ut||-1!==rt.indexOf("<")&&q&&190==K&&">"==at&&!ut)return W(B+1),!1;if(q&&57==K&&!ut)return i("("+l+")",t);if(q&&219==K&&!ut)return i("{"+l+"}",t);if(!q&&219==K&&!ut)return i("["+l+"]",t);if(q&&222==K&&!ut)return i('"'+l+'"',t);if(!q&&222==K&&!ut)return i("'"+l+"'",t);if(!q&&192==K&&!ut)return i("`"+l+"`",t);if(q&&188==K&&!ut)return i("<"+l+">",t);if(q&&tt)return j("( *"+lt+"| *"+nt+"|> *|"+it+")",1,!0),!1;if(tt){if(n.match(/<[^\/>]*?$/)&&">"==r[0]){var ft=/<([^\/>]*?)$/.exec(n);return Y.value=n+" "+l+"></"+ft[1].split(" ")[0]+r,W(o+1,X),!1}return G(et.tabSize),!1}if(D&&90==K)return A.undo(),!1;if(D&&89==K||D&&82==K)return A.redo(),!1;if(et.shortcut){if(D&&66==K)return st.bold.click(),!1;if(D&&73==K)return st.italic.click(),!1;if(D&&81==K)return st["quote-right"].click(),!1;if(D&&72==K)return st.header.click(),!1;if(D&&76==K)return st.link.click(),!1;if(D&&71==K)return st.image.click(),!1}if(32==K){var ft="(^|\\n)("+c(lt)+"|"+c(nt)+")";if(n.match(RegExp(ft+"$")))return Y.value=n.replace(RegExp(ft+"$"),"$1 $2 ")+l+r,W(B+2,X),!1}if(13==K){if(Z&&0===l.length)return Q(P),!1;var dt=RegExp("(?:^|\\n)( *)("+lt+"|"+nt+"|> )( *)(.*?)$");if(n.match(dt)){var pt=dt.exec(n),ht=RegExp(lt).test(pt[2])?et.OL.replace(/%d/g,parseInt(pt[2],10)+1):pt[2];return Q("\n"+pt[1]+ht+pt[3],1),U.scroll(),!1}var gt=RegExp("(?:^|\\n)(("+it+")+)(.*?)$").exec(n),mt=gt?gt[1]:"";return n.match(/[\(\{\[]$/)&&r.match(/^[\]\}\)]/)||n.match(/<[^\/]*?>$/)&&r.match(/^<\//)?(Q("\n"+mt+it+"\n"+mt,function(){W(o+mt.length+et.tabSize.length+1,X)}),U.scroll(),!1):(Q("\n"+mt),U.scroll(),!1)}var vt={"'":s,'"':d,"---":h,"--":p,"...":g,"|":m,"(c)":v,"(C)":v,"(p)":x,"(P)":x,"(sm)":b,"(SM)":b," sm":b," SM":b,"(tm)":k,"(TM)":k," tm":k," TM":k,"(r)":y,"(R)":y,"+-":C,"-+":C,"/":E,"^":_,"<<":$,">>":O,"<":L,">":T,"<=":R,">=":H,"!=":M};if(l.length>0){if(Z){F(/'([^']*?)'/g,u+"$1"+s,V),F(/"([^"]*?)"/g,f+"$1"+d,V);for(var xt in vt)F(RegExp(a(xt),"g"),vt[xt],V);return X(),!1}}else{if(Z){if(-1!==n.indexOf('"')&&'"'==r[0])return Y.value=n.replace(/"([^"]*?)$/,f+"$1")+d+r.slice(1),W(B,X),!1;if(-1!==n.indexOf("'")&&"'"==r[0])return Y.value=n.replace(/'([^']*?)$/,u+"$1")+s+r.slice(1),W(B,X),!1;if(n.slice(-2).match(/\w'$/i))return Y.value=n.slice(0,-1)+s+r,W(B,X),!1;if(n.match(/\((c|p|sm|tm|r)$/i)&&")"==r[0]){var bt=n.match(/\((sm|tm)$/i)?2:1;return Y.value=n.slice(0,-(bt+1))+vt["("+n.slice(-bt).toLowerCase()+")"]+r.slice(bt),W(B-bt,X),!1}var kt=n.replace(/&lt;/g,"<").replace(/&gt;/g,">"),yt=r.replace(/&lt;/g,"<").replace(/&gt;/g,">");if(-1!==kt.indexOf("<<")&&0===yt.indexOf(">>"))return Y.value=n.replace(/(?:<<|&lt;&lt;)([^<]*)$/,$+"$1")+r.replace(/^(?:>>|&gt;&gt;)/,O),W(kt.length-1,X),!1;if(-1!==kt.indexOf("<")&&0===yt.indexOf(">"))return Y.value=n.replace(/(?:<|&lt;)([^<]*)$/,L+"$1")+r.replace(/^(?:>|&gt;)/,T),W(kt.length,X),!1;for(var xt in vt)if(n.slice(-xt.length)==xt)return Y.value=n.slice(0,-xt.length)+vt[xt]+r,W(o-xt.length+1,X),!1;if(37==K)return Q(S),!1;if(38==K)return Q(I),!1;if(39==K)return Q(w),!1;if(40==K)return Q(N),!1}if(8==K){var ft=" *("+lt+"|"+nt+"|> )";if(n.match(RegExp(ft+"$")))return j(ft,1,!0),!1;if(n.match(RegExp(it+"$")))return j(et.tabSize),!1;if(n.match(/<\/?[^>]*?>$/))return j("</?[^>]*?>",1,!0),!1;switch(n.slice(-1)){case"(":return ct("(",")"),!1;case"{":return ct("{","}"),!1;case"[":return ct("[","]"),!1;case'"':return ct('"','"'),!1;case"'":return ct("'","'"),!1;case"<":return ct("<",">"),!1;case"*":return ct("*","*"),!1;case"_":return ct("_","_"),!1;case"~":return ct("~","~"),!1;case"`":return ct("`","`"),!1;case f:return ct(f,d),!1;case u:return ct(u,s),!1;case $:return ct($,O),!1;case L:return ct(L,T),!1}}}return 39==K&&r.match(/^<\/.*?>/)?(W(B+r.indexOf(">")+1),!1):27==K?(ot.focus(),!1):void(Z||D||q||z.setTimeout(X,1))},et.ready(U),U.grip=A,U.grip.config=et};